{
  "openapi": "3.1.0",
  "info": {
    "title": "Semantic-Preserving SMT-LIB Pipeline",
    "description": "\n# Intelligent Formal Verification Service\n\nTransform natural language requirements into verified formal logic through an AI-powered quality assurance pipeline.\n\n## Overview\n\nThis service provides a production-grade API for converting informal logical constraints and business rules into formally verified representations. It ensures accuracy through multiple quality gates and automatic error correction.\n\n<!-- Mermaid diagram - renders in GitHub and Swagger UI -->\n## How It Works\n\n```mermaid\ngraph LR\n    A[Natural Language Input] --> B[AI-Powered Processing]\n    B --> C[Verified Output]\n```\n\nThe service implements an intelligent three-phase process with quality verification at each stage:\n\n### Phase 1: Formalization\n- Converts informal text to formal, structured representation\n- AI-powered analysis ensures meaning is preserved\n- Automatic quality verification and retry mechanisms\n\n### Phase 2: Logic Generation\n- Generates verified formal representations from structured text\n- Measures accuracy throughout transformation\n- Intelligent refinement to minimize information loss\n\n### Phase 3: Formal Verification\n- Validates logic with enterprise-grade verification engine\n- Verifies syntax and logical correctness\n- Automatic error detection and correction\n\n## Key Features\n\n- **Accuracy Preservation**: Advanced AI ensures meaning is maintained throughout transformation\n- **Quality Assurance**: Multiple quality gates verify output accuracy\n- **Intelligent Automation**: Automatic retry and error correction mechanisms\n- **High Reliability**: Production-tested pipeline with comprehensive validation\n- **Detailed Metrics**: Complete visibility into processing quality and performance\n\n## Use Cases\n\n- Formal verification of business requirements\n- Automated constraint validation\n- Requirements analysis and verification\n- Business rule transformation\n- Compliance and regulatory verification\n\n## Documentation\n\n- **Swagger UI**: Interactive API documentation and testing\n- **ReDoc**: Alternative documentation view\n- **Health Check**: Service status at `/health`\n\n## Support\n\nFor issues, questions, or feature requests, please refer to the project repository.\n    ",
    "contact": {
      "name": "Formal Verification Team",
      "email": "support@example.com"
    },
    "license": {
      "name": "CC BY-NC-ND 4.0",
      "url": "https://creativecommons.org/licenses/by-nc-nd/4.0/"
    },
    "version": "0.1.0"
  },
  "paths": {
    "/pipeline/process": {
      "post": {
        "tags": [
          "pipeline",
          "Pipeline Processing"
        ],
        "summary": "Process informal text to verified formal logic",
        "description": "Transform informal natural language into verified formal logic through an intelligent quality assurance pipeline.\n\n    <!-- Mermaid diagram - renders in GitHub and Swagger UI -->\n    ## How It Works\n\n    ```mermaid\n    graph LR\n        A[Natural Language Input] --> B[AI-Powered Processing]\n        B --> C[Verified Output]\n    ```\n\n    This endpoint executes a rigorous three-phase process with automated quality verification:\n\n    ### Phase 1: Formalization\n    - Converts informal text to formal, structured representation\n    - AI-powered analysis ensures meaning preservation\n    - Automatic quality verification and intelligent retry\n\n    ### Phase 2: Logic Generation\n    - Generates verified formal representations from structured text\n    - Includes complete variable declarations and logical assertions\n    - Continuous accuracy monitoring\n    - Intelligent refinement to ensure quality\n\n    ### Phase 3: Formal Verification\n    - Validates logic with enterprise-grade verification engine\n    - Verifies syntax and logical correctness\n    - Returns verification results (satisfiable/unsatisfiable/unknown)\n    - Automatic error detection and correction\n\n    ## Quality Assurance\n\n    - Multiple quality gates throughout the pipeline\n    - Accuracy preservation verified at each phase\n    - Automated quality checks and validation\n    - Comprehensive quality metrics in response\n\n    ## Performance\n\n    - Typical processing time: 3-10 seconds\n    - Depends on text complexity and retry attempts\n    - Detailed metrics returned in response\n\n    ## Example Request\n\n    ```json\n    {\n      \"informal_text\": \"x must be greater than 5 and less than 10\"\n    }\n    ```\n\n    ## Example Success Response (200)\n\n    ```json\n    {\n      \"informal_text\": \"x must be greater than 5 and less than 10\",\n      \"formal_text\": \"The integer variable x must satisfy: x > 5 AND x < 10\",\n      \"formalization_similarity\": 0.95,\n      \"smt_lib_code\": \"(declare-const x Int)\\n(assert (> x 5))\\n(assert (< x 10))\\n(check-sat)\\n(get-model)\",\n      \"extraction_degradation\": 0.03,\n      \"check_sat_result\": \"sat\",\n      \"model\": \"((x 7))\",\n      \"unsat_core\": null,\n      \"solver_success\": true,\n      \"proof\": {\n        \"raw_output\": \"(sat)\\n((x 7))\",\n        \"summary\": \"Verification successful: Found satisfying assignment where x=7\"\n      },\n      \"metrics\": { ... },\n      \"passed_all_checks\": true\n    }\n    ```\n\n    ## Error Scenarios\n\n    - **422 Unprocessable Entity**: Pipeline processing failed at one of the three phases\n    - **500 Internal Server Error**: Unexpected system error (API failures, etc.)",
        "operationId": "process_informal_text_pipeline_process_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProcessRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully processed text through all three pipeline phases",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProcessResponse"
                },
                "example": {
                  "informal_text": "x must be greater than 5 and less than 10",
                  "formal_text": "The integer variable x must satisfy the following constraints: x is greater than 5 AND x is less than 10",
                  "formalization_similarity": 0.95,
                  "smt_lib_code": "; Formalization: The integer variable x must satisfy: x > 5 AND x < 10\n(declare-const x Int)\n(assert (> x 5))\n(assert (< x 10))\n(check-sat)\n(get-model)",
                  "extraction_degradation": 0.03,
                  "check_sat_result": "sat",
                  "model": "((x 7))",
                  "solver_success": true,
                  "metrics": {
                    "formalization_attempts": 1,
                    "final_formalization_similarity": 0.95,
                    "formalization_time_seconds": 1.2,
                    "extraction_attempts": 1,
                    "final_extraction_degradation": 0.03,
                    "extraction_time_seconds": 1.5,
                    "validation_attempts": 1,
                    "solver_execution_time_seconds": 0.3,
                    "total_time_seconds": 3.0,
                    "success": true
                  },
                  "passed_all_checks": true
                }
              }
            }
          },
          "422": {
            "description": "Pipeline processing failed at formalization, extraction, or validation phase",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "formalization_failure": {
                    "summary": "Formalization failed to meet quality threshold",
                    "value": {
                      "error": "Formalization failed: Could not achieve required semantic similarity threshold",
                      "details": {
                        "step": "formalization",
                        "message": "Quality threshold not met after multiple attempts"
                      }
                    }
                  },
                  "extraction_failure": {
                    "summary": "Logic generation failed quality check",
                    "value": {
                      "error": "Logic generation failed: Accuracy preservation below acceptable threshold",
                      "details": {
                        "step": "extraction",
                        "message": "Quality threshold not met after refinement attempts"
                      }
                    }
                  },
                  "validation_failure": {
                    "summary": "Formal verification failed",
                    "value": {
                      "error": "Formal verification failed: Syntax error detected in generated logic",
                      "details": {
                        "step": "validation",
                        "message": "Verification engine detected syntax error"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error (API failure, system error, etc.)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Internal server error during pipeline processing"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "Health & Status"
        ],
        "summary": "Service health check",
        "description": "Check the health and status of the Formal Verification service.\n\n    Returns basic service information including:\n    - **status**: Current service health (healthy/degraded/unhealthy)\n    - **service**: Service name\n    - **version**: Current API version\n\n    Use this endpoint for:\n    - Service monitoring and alerting\n    - Load balancer health checks\n    - Deployment verification\n    - Status page integration\n\n    ## Example Response\n\n    ```json\n    {\n      \"status\": \"healthy\",\n      \"service\": \"Formal Symbolic Verification\",\n      \"version\": \"0.1.0\"\n    }\n    ```",
        "operationId": "health_check_health_get",
        "responses": {
          "200": {
            "description": "Service is healthy and operational",
            "content": {
              "application/json": {
                "schema": {},
                "example": {
                  "status": "healthy",
                  "service": "Intelligent Formal Verification",
                  "version": "0.1.0"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ErrorResponse": {
        "properties": {
          "error": {
            "type": "string",
            "title": "Error",
            "description": "Human-readable error message describing what went wrong. Includes the pipeline step that failed and the reason for failure.",
            "examples": [
              "Formalization failed: Could not achieve required semantic similarity threshold",
              "Symbolic logic generation failed: Information preservation below acceptable threshold",
              "Formal verification failed: Syntax error detected in generated logic"
            ]
          },
          "details": {
            "anyOf": [
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Details",
            "description": "Additional structured error details for debugging. May include: attempt counts, quality scores, solver output, or other diagnostic information. Not always present - only included when relevant context is available.",
            "examples": [
              {
                "attempts": 3,
                "final_similarity": 0.89,
                "step": "formalization",
                "threshold": 0.91
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "error"
        ],
        "title": "ErrorResponse",
        "description": "Error response model returned when pipeline processing fails.\n\nProvides detailed information about what went wrong and at which stage,\nhelping developers debug issues with their input or understand processing limitations.",
        "examples": [
          {
            "details": {
              "attempts": 3,
              "final_similarity": 0.89,
              "step": "formalization",
              "threshold": 0.91
            },
            "error": "Formalization failed: Could not achieve required similarity threshold after 3 attempts"
          },
          {
            "details": {
              "solver_output": "Parse error at line 3: unexpected token ','",
              "step": "validation"
            },
            "error": "Formal verification failed: Syntax error detected in logic"
          }
        ]
      },
      "PipelineMetrics": {
        "properties": {
          "formalization_attempts": {
            "type": "integer",
            "maximum": 10.0,
            "minimum": 0.0,
            "title": "Formalization Attempts",
            "description": "Number of attempts required to achieve formalization similarity threshold (0=skipped, 1-10=actual attempts)"
          },
          "final_formalization_similarity": {
            "type": "number",
            "maximum": 1.0,
            "minimum": 0.0,
            "title": "Final Formalization Similarity",
            "description": "Final embedding similarity score between informal and formal text (0.0-1.0, threshold: 0.91)"
          },
          "formalization_time_seconds": {
            "type": "number",
            "minimum": 0.0,
            "title": "Formalization Time Seconds",
            "description": "Total time spent on formalization step in seconds"
          },
          "extraction_attempts": {
            "type": "integer",
            "maximum": 10.0,
            "minimum": 1.0,
            "title": "Extraction Attempts",
            "description": "Number of attempts required to achieve extraction degradation threshold (1-10)"
          },
          "final_extraction_degradation": {
            "type": "number",
            "maximum": 1.0,
            "minimum": 0.0,
            "title": "Final Extraction Degradation",
            "description": "Final information degradation score from formal text to SMT-LIB (0.0-1.0, threshold: 0.05)"
          },
          "extraction_time_seconds": {
            "type": "number",
            "minimum": 0.0,
            "title": "Extraction Time Seconds",
            "description": "Total time spent on SMT-LIB extraction step in seconds"
          },
          "validation_attempts": {
            "type": "integer",
            "maximum": 10.0,
            "minimum": 1.0,
            "title": "Validation Attempts",
            "description": "Number of attempts required to achieve successful solver execution (1-10, includes error fixes)"
          },
          "solver_execution_time_seconds": {
            "type": "number",
            "minimum": 0.0,
            "title": "Solver Execution Time Seconds",
            "description": "Total time spent executing SMT solver in seconds"
          },
          "total_time_seconds": {
            "type": "number",
            "minimum": 0.0,
            "title": "Total Time Seconds",
            "description": "Total end-to-end pipeline execution time in seconds"
          },
          "success": {
            "type": "boolean",
            "title": "Success",
            "description": "Whether the entire pipeline completed successfully (all steps passed)"
          }
        },
        "type": "object",
        "required": [
          "formalization_attempts",
          "final_formalization_similarity",
          "formalization_time_seconds",
          "extraction_attempts",
          "final_extraction_degradation",
          "extraction_time_seconds",
          "validation_attempts",
          "solver_execution_time_seconds",
          "total_time_seconds",
          "success"
        ],
        "title": "PipelineMetrics",
        "description": "Performance and quality metrics for the entire pipeline."
      },
      "ProcessRequest": {
        "properties": {
          "informal_text": {
            "type": "string",
            "maxLength": 100000,
            "minLength": 1,
            "title": "Informal Text",
            "description": "Informal natural language text containing logical constraints or rules to process. Should describe conditions, relationships, or requirements that can be formalized. Examples: 'x must be greater than 5', 'the sum of a and b equals 10', 'all employees must have a valid ID number'",
            "examples": [
              "x must be greater than 5 and less than 10",
              "the sum of a and b must equal 10",
              "if x is even then y must be odd"
            ]
          },
          "skip_formalization": {
            "type": "boolean",
            "title": "Skip Formalization",
            "description": "Skip formalization step and treat input as already formal. Useful for simple expressions like 'x > 5' that don't need AI processing. The service automatically skips formalization for very short inputs, but this flag allows explicit control.",
            "default": false
          },
          "enrich": {
            "type": "boolean",
            "title": "Enrich",
            "description": "Enable web search enrichment before processing. When enabled, the service will use web search to gather domain-specific definitions, context, and clarifications before running the main pipeline. Useful for inputs containing domain-specific terminology or ambiguous references.",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "informal_text"
        ],
        "title": "ProcessRequest",
        "description": "Request model for processing informal text through the formal verification pipeline.\n\nThe informal text will be transformed through three rigorous steps:\n1. **Formalization**: Converts informal text to formal representation with semantic preservation\n2. **Symbolic Logic Generation**: Generates verified symbolic representations with accuracy validation\n3. **Formal Verification**: Validates logic with verification engine to ensure correctness\n\nEach step includes automatic quality verification and intelligent retry mechanisms.",
        "examples": [
          {
            "informal_text": "x must be greater than 5 and less than 10"
          },
          {
            "informal_text": "the sum of a and b must equal 10"
          },
          {
            "informal_text": "if x is positive then y must be negative"
          },
          {
            "informal_text": "x > 5",
            "skip_formalization": true
          }
        ]
      },
      "ProcessResponse": {
        "properties": {
          "informal_text": {
            "type": "string",
            "title": "Informal Text",
            "description": "The original informal natural language text that was processed"
          },
          "enrichment_performed": {
            "type": "boolean",
            "title": "Enrichment Performed",
            "description": "Whether web search enrichment was performed on the input",
            "default": false
          },
          "enrichment_search_count": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Enrichment Search Count",
            "description": "Number of web searches performed during enrichment (if enabled)"
          },
          "enrichment_sources": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Enrichment Sources",
            "description": "URLs of sources used for enrichment (if enabled)"
          },
          "enrichment_time_seconds": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Enrichment Time Seconds",
            "description": "Time spent on enrichment in seconds (if enabled)"
          },
          "formal_text": {
            "type": "string",
            "title": "Formal Text",
            "description": "Formalized version of the informal text with preserved semantics. This text maintains the same meaning but uses more precise, structured language suitable for further processing.",
            "examples": [
              "The integer variable x must satisfy the constraint: x > 5 AND x < 10"
            ]
          },
          "formalization_similarity": {
            "type": "number",
            "maximum": 1.0,
            "minimum": 0.0,
            "title": "Formalization Similarity",
            "description": "Semantic similarity score between informal and formal text. Measures how well the original meaning was preserved. Range: 0.0 (low similarity) to 1.0 (high similarity). Higher values indicate better semantic preservation.",
            "examples": [
              0.95
            ]
          },
          "smt_lib_code": {
            "type": "string",
            "title": "Smt Lib Code",
            "description": "Complete symbolic logic representation that can be verified by formal verification engine. Includes variable declarations, assertions, and verification commands. Contains inline comments explaining the formalization.",
            "examples": [
              "(declare-const x Int)\n(assert (> x 5))\n(assert (< x 10))\n(check-sat)\n(get-model)"
            ]
          },
          "extraction_degradation": {
            "type": "number",
            "maximum": 1.0,
            "minimum": 0.0,
            "title": "Extraction Degradation",
            "description": "Information preservation score during symbolic logic generation. Measures how accurately information was transformed. Range: 0.0 (perfect preservation) to 1.0 (significant loss). Lower values indicate better information retention.",
            "examples": [
              0.03
            ]
          },
          "check_sat_result": {
            "type": "string",
            "title": "Check Sat Result",
            "description": "Result from formal verification engine. Possible values: 'sat' (satisfiable - solution exists), 'unsat' (unsatisfiable - no solution possible), 'unknown' (engine could not determine), or an error message if verification failed.",
            "examples": [
              "sat"
            ]
          },
          "model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Model",
            "description": "Model (variable assignments) from solver if check-sat returned 'sat'. Shows concrete values that satisfy all constraints. Example: '((x 7))' means x=7 satisfies the constraints. None if result was 'unsat' or 'unknown'.",
            "examples": [
              "((x 7))"
            ]
          },
          "unsat_core": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Unsat Core",
            "description": "Minimal unsatisfiable core from solver if check-sat returned 'unsat'. Identifies the conflicting subset of constraints. Useful for debugging why no solution exists. None if result was 'sat' or 'unknown'."
          },
          "solver_success": {
            "type": "boolean",
            "title": "Solver Success",
            "description": "Whether the formal verification engine executed successfully without errors. True means verification ran and produced a valid result (sat/unsat/unknown). False means there were execution errors (syntax errors, timeouts, etc.).",
            "examples": [
              true
            ]
          },
          "proof": {
            "anyOf": [
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Proof",
            "description": "Verification proof from the formal verification engine. Contains both raw solver output and human-readable summary. Enables external verification and auditing of results.",
            "examples": [
              {
                "raw_output": "(sat)\n((x 7))",
                "summary": "Verification successful: Found satisfying assignment where x=7"
              }
            ]
          },
          "metrics": {
            "$ref": "#/components/schemas/PipelineMetrics",
            "description": "Detailed performance and quality metrics for all three pipeline steps. Includes attempt counts, execution times, and quality scores. Useful for monitoring pipeline performance and identifying bottlenecks."
          },
          "passed_all_checks": {
            "type": "boolean",
            "title": "Passed All Checks",
            "description": "Whether all quality thresholds were met across all three steps. True means all automated quality checks passed successfully. False means at least one quality threshold was not met.",
            "examples": [
              true
            ]
          }
        },
        "type": "object",
        "required": [
          "informal_text",
          "formal_text",
          "formalization_similarity",
          "smt_lib_code",
          "extraction_degradation",
          "check_sat_result",
          "solver_success",
          "metrics",
          "passed_all_checks"
        ],
        "title": "ProcessResponse",
        "description": "Response model containing complete verified output from the formal verification pipeline.\n\nThis response includes outputs from all three pipeline steps, performance metrics,\nand quality indicators. All outputs have been verified to meet semantic similarity\nand information preservation thresholds.",
        "examples": [
          {
            "check_sat_result": "sat",
            "extraction_degradation": 0.03,
            "formal_text": "The integer variable x must satisfy the following constraints: x is greater than 5 AND x is less than 10",
            "formalization_similarity": 0.95,
            "informal_text": "x must be greater than 5 and less than 10",
            "metrics": {
              "extraction_attempts": 1,
              "extraction_time_seconds": 1.5,
              "final_extraction_degradation": 0.03,
              "final_formalization_similarity": 0.95,
              "formalization_attempts": 1,
              "formalization_time_seconds": 1.2,
              "solver_execution_time_seconds": 0.3,
              "success": true,
              "total_time_seconds": 3.0,
              "validation_attempts": 1
            },
            "model": "((x 7))",
            "passed_all_checks": true,
            "proof": {
              "raw_output": "(sat)\n((x 7))",
              "summary": "Verification successful: Found satisfying assignment where x=7"
            },
            "smt_lib_code": "; Formalization: The integer variable x must satisfy: x > 5 AND x < 10\n(declare-const x Int)\n(assert (> x 5))\n(assert (< x 10))\n(check-sat)\n(get-model)",
            "solver_success": true
          }
        ]
      }
    }
  },
  "tags": [
    {
      "name": "Pipeline Processing",
      "description": "Core pipeline endpoints for processing informal text to verified symbolic logic"
    },
    {
      "name": "Health & Status",
      "description": "Service health check and status endpoints"
    }
  ]
}
